{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacoes","NegociacoesView","Mensagem","MensagemView","NegociacaoService","getNegociacaoDao","DataInvalidaException","Negociacao","Bind","DateConverter","NegociacaoController","constructor","$","document","querySelector","bind","_inputData","_inputQuantidade","_inputValor","_negociacoes","_mensagem","_service","importaNegociacoes","obterNegociacoesDoPeriodo","then","negociacoes","filter","novaNegociacao","paraArray","some","negociacaoExistente","equals","forEach","negociacao","adiciona","texto","catch","err","errr","event","preventDefault","_criaNegociacao","_limpaFormulario","message","value","focus","data","paraData","parseInt","parseFloat","apaga","esvazia"],"mappings":";;;;;;AAASA,uB,kCAAAA,W;;AACAC,2B,6BAAAA,e;;AACAC,oB,uBAAAA,Q;;AACAC,wB,0BAAAA,Y;;AACAC,6B,wCAAAA,iB;;AACAC,4B,qBAAAA,gB;;AACAC,iC,wCAAAA,qB;;AACAC,sB,iCAAAA,U;;AACAC,gB,eAAAA,I;;AACAC,yB,gCAAAA,a;;;AAEF,kBAAMC,oBAAN,CAA2B;AAC9BC,8BAAa;AACT,0BAAMC,IAAIC,SAASC,aAAT,CAAuBC,IAAvB,CAA4BF,QAA5B,CAAV;AACA,yBAAKG,UAAL,GAAkBJ,EAAE,OAAF,CAAlB;AACA,yBAAKK,gBAAL,GAAwBL,EAAE,aAAF,CAAxB;AACA,yBAAKM,WAAL,GAAmBN,EAAE,QAAF,CAAnB;;AAEA,yBAAKO,YAAL,GAAoB,IAAIX,IAAJ,CAChB,IAAIR,WAAJ,EADgB,EAEhB,IAAIC,eAAJ,CAAoB,cAApB,CAFgB,EAGhB,UAHgB,EAGJ,SAHI,CAApB;;AAMA,yBAAKmB,SAAL,GAAiB,IAAIZ,IAAJ,CACb,IAAIN,QAAJ,EADa,EAEb,IAAIC,YAAJ,CAAiB,eAAjB,CAFa,EAGb,OAHa,CAAjB;;AAMA,yBAAKkB,QAAL,GAAgB,IAAIjB,iBAAJ,EAAhB;AACH;;AAEDkB,qCAAoB;AAChB,yBAAKD,QAAL,CAAcE,yBAAd,GACCC,IADD,CACMC,eAAe;AACjBA,oCAAYC,MAAZ,CAAmBC,kBACf,CAAC,KAAKR,YAAL,CAAkBS,SAAlB,GACAC,IADA,CACKC,uBAAuBH,eAAeI,MAAf,CAAsBD,mBAAtB,CAD5B,CADL,EAGKE,OAHL,CAGaC,cAAc,KAAKd,YAAL,CAAkBe,QAAlB,CAA2BD,UAA3B,CAH3B;AAIA,6BAAKb,SAAL,CAAee,KAAf,GAAuB,+CAAvB;AACH,qBAPD,EAQCC,KARD,CAQOC,OAAO,KAAKjB,SAAL,CAAee,KAAf,GAAuBG,IARrC;AASH;;AAEDJ,yBAASK,KAAT,EAAe;AACX,wBAAI;AACAA,8BAAMC,cAAN;AACA,6BAAKrB,YAAL,CAAkBe,QAAlB,CAA2B,KAAKO,eAAL,EAA3B;AACA,6BAAKrB,SAAL,CAAee,KAAf,GAAuB,oCAAvB;AACA,6BAAKO,gBAAL;AACH,qBALD,CAMA,OAAML,GAAN,EAAU;AACN,4BAAGA,eAAe/B,qBAAlB,EAAwC;AACpC,iCAAKc,SAAL,CAAee,KAAf,GAAuBE,IAAIM,OAA3B;AACH,yBAFD,MAEK;AACD,iCAAKvB,SAAL,CAAee,KAAf,GAAuB,gEAAvB;AACH;AACJ;AACJ;;AAEDO,mCAAkB;AACd,yBAAK1B,UAAL,CAAgB4B,KAAhB,GAAwB,EAAxB;AACA,yBAAK3B,gBAAL,CAAsB2B,KAAtB,GAA8B,CAA9B;AACA,yBAAK1B,WAAL,CAAiB0B,KAAjB,GAAyB,GAAzB;AACA,yBAAK5B,UAAL,CAAgB6B,KAAhB;AACH;;AAEDJ,kCAAiB;AACb,wBAAIK,OAAOrC,cAAcsC,QAAd,CAAuB,KAAK/B,UAAL,CAAgB4B,KAAvC,CAAX;AACA,2BAAO,IAAIrC,UAAJ,CACHuC,IADG,EAEHE,SAAS,KAAK/B,gBAAL,CAAsB2B,KAA/B,CAFG,EAGHK,WAAW,KAAK/B,WAAL,CAAiB0B,KAA5B,CAHG,CAAP;AAKH;;AAEDM,wBAAO;AACH,yBAAK/B,YAAL,CAAkBgC,OAAlB;AACA,yBAAK/B,SAAL,CAAee,KAAf,GAAuB,mCAAvB;AACH;AArE6B","file":"NegociacaoController.js","sourcesContent":["import { Negociacoes } from '../domain/negociacao/Negociacoes.js';\nimport { NegociacoesView } from '../ui/views/NegociacoesView.js';\nimport { Mensagem } from '../ui/models/Mensagem.js';\nimport { MensagemView } from '../ui/views/MensagemView.js';\nimport { NegociacaoService } from '../domain/negociacao/NegociacaoService.js';\nimport { getNegociacaoDao } from '../util/DaoFactory.js';\nimport { DataInvalidaException } from '../ui/converters/DataInvalidaException.js';\nimport { Negociacao } from '../domain/negociacao/Negociacao.js';\nimport { Bind } from '../util/Bind.js';\nimport { DateConverter } from '../ui/converters/DateConverter.js';\n\nexport class NegociacaoController {\n    constructor(){\n        const $ = document.querySelector.bind(document);\n        this._inputData = $('#data');\n        this._inputQuantidade = $('#quantidade');\n        this._inputValor = $('#valor');\n\n        this._negociacoes = new Bind(\n            new Negociacoes(), \n            new NegociacoesView('#negociacoes'),\n            'adiciona', 'esvazia'\n        );\n        \n        this._mensagem = new Bind(\n            new Mensagem(),\n            new MensagemView('#mensagemView'),\n            'texto'\n        );    \n\n        this._service = new NegociacaoService();\n    }\n\n    importaNegociacoes(){\n        this._service.obterNegociacoesDoPeriodo()\n        .then(negociacoes => {\n            negociacoes.filter(novaNegociacao => \n                !this._negociacoes.paraArray()\n                .some(negociacaoExistente => novaNegociacao.equals(negociacaoExistente)))\n                .forEach(negociacao => this._negociacoes.adiciona(negociacao));\n            this._mensagem.texto = 'Negociações do período importadas com sucesso';\n        })\n        .catch(err => this._mensagem.texto = errr);\n    }\n\n    adiciona(event){\n        try {\n            event.preventDefault();\n            this._negociacoes.adiciona(this._criaNegociacao());\n            this._mensagem.texto = 'Negociação adicionada com sucesso!';\n            this._limpaFormulario();\n        }\n        catch(err){\n            if(err instanceof DataInvalidaException){\n                this._mensagem.texto = err.message;\n            }else{\n                this._mensagem.texto = 'Um erro não esperado aconteceu. Entre em contato com o suporte';\n            }\n        }\n    }\n\n    _limpaFormulario(){\n        this._inputData.value = '';\n        this._inputQuantidade.value = 1;\n        this._inputValor.value = 0.0;\n        this._inputData.focus();\n    }\n\n    _criaNegociacao(){\n        let data = DateConverter.paraData(this._inputData.value);\n        return new Negociacao(\n            data,\n            parseInt(this._inputQuantidade.value),\n            parseFloat(this._inputValor.value)\n        );\n    }\n\n    apaga(){\n        this._negociacoes.esvazia();\n        this._mensagem.texto = 'Negociações apagadas com sucesso!';\n    }\n}"]}